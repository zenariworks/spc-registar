{% extends "base.html" %}
{% load static phone_filters %}

{% block title %}{{ slava.naziv }} - Домаћинства{% endblock %}

{% block content %}
<div class="u-page-header">
  <a href="{% url 'kalendar' %}" class="back-button" aria-label="Назад на календар" title="Назад на календар">
    <i class="fa-solid fa-arrow-left"></i>
  </a>
  <h1 class="u-page-title">{{ slava.naziv }}</h1>
</div>

<div style="background: var(--color-gray-800); padding: 20px; border-radius: 8px; margin-bottom: 30px;" data-theme-aware>
  <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
    <i class="fa-solid fa-calendar-day" style="font-size: 32px; color: var(--color-primary);"></i>
    <div>
      <h2 style="margin: 0; color: var(--color-gray-700);" data-theme-text>{{ slava.naziv }}</h2>
      {% if slava.mesec and slava.dan %}
        <p style="margin: 5px 0 0 0; color: var(--color-gray-600); font-size: 16px;" data-theme-text-secondary>
          {{ slava.dan }}. {{ slava.get_mesec_naziv }}
        </p>
      {% elif slava.pokretni %}
        <p style="margin: 5px 0 0 0; color: var(--color-gray-600); font-size: 16px;" data-theme-text-secondary>
          Покретни празник
        </p>
      {% endif %}
    </div>
  </div>

  <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid var(--color-primary);" data-theme-card>
    <i class="fa-solid fa-house" style="color: var(--color-primary);"></i>
    <strong data-theme-text>Број домаћинстава:</strong>
    <span style="font-size: 18px; color: var(--color-primary); font-weight: 600;">{{ count }}</span>
  </div>
</div>

{% if domacinstva %}
  <div style="display: flex; flex-direction: column; gap: 15px;">
    {% for domacinstvo in domacinstva %}
      <div class="domacinstvo-card" style="background: white; border-radius: 8px; padding: 20px; border: 1px solid var(--color-gray-400); transition: box-shadow 0.2s;" data-theme-card>
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
          <div style="flex: 1;">
            <h3 style="margin: 0 0 8px 0; color: var(--color-gray-700);" data-theme-text>
              <i class="fa-solid fa-user" style="color: var(--color-primary); margin-right: 8px;"></i>
              {% if domacinstvo.domacin %}
                <a href="{% url 'parohijan_detail' uid=domacinstvo.domacin.uid %}" class="u-link-primary">
                  {{ domacinstvo.domacin.ime }} {{ domacinstvo.domacin.prezime }}
                </a>
              {% else %}
                <span style="color: var(--color-gray-500);">Непознат домаћин</span>
              {% endif %}
            </h3>

            {% if domacinstvo.adresa %}
              <div style="color: var(--color-gray-600); margin-bottom: 4px;" data-theme-text-secondary>
                <i class="fa-solid fa-location-dot" style="width: 20px; color: var(--color-gray-600);"></i>
                {% if domacinstvo.adresa.ulica %}
                  {{ domacinstvo.adresa.ulica.naziv }}
                  {% if domacinstvo.adresa.broj %}{{ domacinstvo.adresa.broj }}{% endif %}
                {% else %}
                  {{ domacinstvo.adresa }}
                {% endif %}
              </div>
            {% endif %}

            <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 8px;">
              {% if domacinstvo.tel_fiksni %}
                <a href="tel:{{ domacinstvo.tel_fiksni|tel_link }}" class="u-link-primary" data-theme-text-secondary>
                  <i class="fa-solid {{ domacinstvo.tel_fiksni|phone_icon }}" style="width: 20px;"></i>
                  {{ domacinstvo.tel_fiksni|format_phone }}
                </a>
              {% endif %}
              {% if domacinstvo.tel_mobilni %}
                <a href="tel:{{ domacinstvo.tel_mobilni|tel_link }}" class="u-link-primary" data-theme-text-secondary>
                  <i class="fa-solid {{ domacinstvo.tel_mobilni|phone_icon }}" style="width: 20px;"></i>
                  {{ domacinstvo.tel_mobilni|format_phone }}
                </a>
              {% endif %}
            </div>
          </div>

          <a href="{% url 'domacinstvo_detail' uid=domacinstvo.uid %}"
             style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: var(--color-primary); color: white; text-decoration: none; border-radius: 6px; font-weight: 500; transition: background 0.2s;"
             onmouseover="this.style.background='var(--color-primary-hover)'"
             onmouseout="this.style.background='var(--color-primary)'"
            Детаљи
            <i class="fa-solid fa-arrow-right"></i>
          </a>
        </div>

        {% if domacinstvo.ukucani.all %}
          <div style="border-top: 1px solid var(--color-gray-400); padding-top: 15px; margin-top: 10px;">
            <div style="color: var(--color-gray-600); font-size: 14px; margin-bottom: 10px; font-weight: 500;" data-theme-text-secondary>
              <i class="fa-solid fa-users" style="margin-right: 6px;"></i>
              Чланови домаћинства ({{ domacinstvo.ukucani.all.count }})
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
              {% for ukucanin in domacinstvo.ukucani.all %}
                <div style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: {% if ukucanin.preminuo %}var(--color-gray-800){% else %}var(--color-info-light){% endif %}; border-radius: 20px; font-size: 14px; border: 1px solid {% if ukucanin.preminuo %}var(--color-gray-dark){% else %}var(--color-info-border-light){% endif %};" data-theme-aware>
                  {% if ukucanin.preminuo %}
                    <span style="color: var(--color-gray-600);">†</span>
                  {% endif %}
                  {% if ukucanin.osoba %}
                    <a href="{% url 'parohijan_detail' uid=ukucanin.osoba.uid %}" style="color: {% if ukucanin.preminuo %}var(--color-gray-600){% else %}var(--color-info-link){% endif %}; text-decoration: none;">
                      {{ ukucanin.osoba.ime }} {{ ukucanin.osoba.prezime }}
                    </a>
                  {% else %}
                    <span style="color: var(--color-gray-500);">{{ ukucanin.ime_prezime|default:"Непознато" }}</span>
                  {% endif %}
                  {% if ukucanin.uloga %}
                    <span style="background: var(--color-primary-transparent); color: var(--color-primary); padding: 2px 8px; border-radius: 10px; font-size: 12px; font-weight: 500;">
                      {{ ukucanin.uloga }}
                    </span>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <div style="text-align: center; padding: 60px 20px; background: var(--color-gray-900); border-radius: 8px; border: 2px dashed var(--color-gray-border);" data-theme-aware>
    <i class="fa-solid fa-house-circle-xmark" style="font-size: 64px; color: var(--color-gray-light); margin-bottom: 20px;"></i>
    <p style="color: var(--color-gray-600); font-size: 18px; margin: 0;" data-theme-text-secondary>
      Нема домаћинстава која славе {{ slava.naziv }}
    </p>
  </div>
{% endif %}

<style>
[data-theme="dark"] [data-theme-aware],
[data-theme="dark"] [data-theme-card] {
  background: var(--color-dark-bg) !important;
  border-color: var(--color-dark-border) !important;
}

[data-theme="dark"] [data-theme-text] {
  color: var(--color-dark-text) !important;
}

[data-theme="dark"] [data-theme-text-secondary] {
  color: var(--color-dark-text-secondary) !important;
}

.domacinstvo-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] .domacinstvo-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}
</style>

{% endblock %}
