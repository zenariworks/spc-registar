<!-- base.html -->
{% load static %}
{% load compress %}
{% comment %} {% load django_select2 %} {% endcomment %}
<!DOCTYPE html>
<html lang="{{ settings.LANGUAGE_CODE }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="theme-color" content="#A21514">
    <meta name="mobile-web-app-capable" content="yes">
    <script>
      // Apply saved theme as early as possible to avoid flash
      (function() {
        try {
          var saved = localStorage.getItem('theme');
          if (saved) {
            document.documentElement.setAttribute('data-theme', saved);
          }
        } catch (e) {
          // ignore
        }
      })();
    </script>

    <!-- Core styles split into separate files for parallel loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">

    {% compress css %}
      <!-- Centralized local fonts (must be loaded before components for correct metrics) -->
      <link rel="stylesheet" href="{% static 'registar/base/fonts.css' %}">
      <!-- Base tokens and globals -->
      <link rel="stylesheet" href="{% static 'registar/base/tokens.css' %}">
      <!-- Utilities -->
      <link rel="stylesheet" href="{% static 'registar/utilities/utilities.css' %}">
      <!-- Layout and components -->
      <link rel="stylesheet" href="{% static 'registar/layout/sidebar.css' %}">
      <!-- Split component styles -->
      <link rel="stylesheet" href="{% static 'registar/components/buttons.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/hero.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/grid.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/cards.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/actions.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/reminders.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/timeline.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/lists.css' %}">
      <link rel="stylesheet" href="{% static 'registar/components/forms.css' %}">
      <!-- Dark theme overrides (loaded last for correct specificity) -->
      <link rel="stylesheet" href="{% static 'registar/themes/dark.css' %}">
    {% endcompress %}
    {% block extra_css %}{% endblock %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css">

    <link rel="icon" href="{% static 'registar/favicon.png' %}" type="image/x-icon">
    <title>Црквени регистар</title>
  </head>
  <body>
    {% include 'sidebar.html' %}
    <!-- Главни садржај странице биће додат овде -->
    <main class="u-container">
      {% block content %}{% endblock %}
    </main>
    <script>
      // Update body class based on sidebar state
      (function() {
        const sidebar = document.getElementById('sidebar');
        if (sidebar) {
          // Initial check
          if (sidebar.classList.contains('collapsed')) {
            document.body.classList.add('sidebar-collapsed');
          }

          // Observer for sidebar class changes
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.attributeName === 'class') {
                if (sidebar.classList.contains('collapsed')) {
                  document.body.classList.add('sidebar-collapsed');
                } else {
                  document.body.classList.remove('sidebar-collapsed');
                }
              }
            });
          });

          observer.observe(sidebar, { attributes: true });
        }
      })();
    </script>
  </body>
</html>
