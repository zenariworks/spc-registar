<!-- header.html -->
{% load static %}
<header>
  <div class="container header-bar">
    <div class="fusion-logo">
       <a href="{% url 'pocetna' %}">
       <img src="https://spc.rs/wp-content/uploads/2022/03/spc-logo.png" alt="Logo СПЦ">
       </a>
    </div>
    <div class="menu-search-wrapper">
       <button class="hamburger-menu" onclick="toggleMenu()" aria-label="Отвори мени">
       <i class="bi bi-list"></i>
       </button>
       <nav id="menu" aria-label="Главни мени">
         <ul>
         {% url 'krstenja' as krstenja_url %}
         {% url 'vencanja' as vencanja_url %}
         {% url 'unos_krstenja' as unos_krstenja_url %}
         {% url 'unos_vencanja' as unos_vencanja_url %}
         {% url 'unos_parohijana' as unos_parohijana_url %}
         <li><a href="{{ krstenja_url }}" class="{% if request.path == krstenja_url %}active{% endif %}">Крштења</a></li>
         <li><a href="{{ vencanja_url }}" class="{% if request.path == vencanja_url %}active{% endif %}">Венчања</a></li>
         <li>
            <a href="#">Уноси</a>
            <ul class="dropdown">
               <li><a href="{{ unos_krstenja_url }}" class="{% if request.path == unos_krstenja_url %}active{% endif %}">Крштење</a></li>
               <li><a href="{{ unos_vencanja_url }}" class="{% if request.path == unos_vencanja_url %}active{% endif %}">Венчање</a></li>
               <li><a href="{{ unos_parohijana_url }}" class="{% if request.path == unos_parohijana_url %}active{% endif %}">Парохијан</a></li>
            </ul>
         </li>
           <li class="theme-icon">
              <a href="#" id="theme-toggle" class="fusion-main-menu-icon" aria-label="Промени тему" title="Промени тему">
                <i class="bi bi-sun"></i>
              </a>
           </li>
           <li class="search-icon">
              <a href="#" id="search-trigger" class="fusion-main-menu-icon">
              <i class="bi bi-search"></i>
              </a>
           </li>
        </ul>
       </nav>
       <div id="search-overlay" style="display: none;">
         <form method="get" action="{% url 'search_view' %}" class="search-form">
            <div class="search-box">
               <button type="submit" class="search-icon-button"><i class="bi bi-search"></i></button>
               <input type="text" name="query" placeholder="Претрага..." autofocus>
               <a href="#" id="close-search" class="close-search"><i class="bi bi-x-lg"></i></a>
            </div>
         </form>
       </div>
    </div>
  </div>
  <script>
     document.getElementById('search-trigger').addEventListener('click', function(event) {
       event.preventDefault();
       document.getElementById("menu").style.display = "none";
       document.getElementById('search-overlay').style.display = 'flex';
     });

     document.getElementById('close-search').addEventListener('click', function(event) {
       event.preventDefault();
       document.getElementById('search-overlay').style.display = 'none';
       document.getElementById("menu").style.display = "flex";
     });
     // ESC zatvara pretragu
     document.addEventListener('keydown', function(event) {
       if (event.key === 'Escape') {
         document.getElementById('search-overlay').style.display = 'none';
         document.getElementById("menu").style.display = "flex";
       }
     });
     // Klik van polja zatvara pretragu
     document.addEventListener('click', function(event) {
       const overlay = document.getElementById('search-overlay');
       const searchTrigger = document.getElementById('search-trigger');
       if (!overlay.contains(event.target) && event.target !== searchTrigger) {
         if (overlay.style.display === 'flex') {
           overlay.style.display = 'none';
           document.getElementById("menu").style.display = "flex";
         }
       }
     });

     // Theme toggle
     (function() {
       var toggle = document.getElementById('theme-toggle');
       var iconEl = toggle ? toggle.querySelector('i') : null;

       function setTheme(t) {
         document.documentElement.setAttribute('data-theme', t);
         try { localStorage.setItem('theme', t); } catch(e){}
       }
       function getTheme() {
         return document.documentElement.getAttribute('data-theme') || 'light';
       }
       function updateThemeIcon() {
         var current = getTheme();
         if (!iconEl) return;
         // Swap Bootstrap Icons based on theme
         if (current === 'dark') {
           iconEl.className = 'bi bi-moon';
           toggle.setAttribute('aria-label', 'Промени тему: светла');
           toggle.setAttribute('title', 'Промени на светлу тему');
           toggle.setAttribute('aria-pressed', 'true');
         } else {
           iconEl.className = 'bi bi-sun';
           toggle.setAttribute('aria-label', 'Промени тему: тамна');
           toggle.setAttribute('title', 'Промени на тамну тему');
           toggle.setAttribute('aria-pressed', 'false');
         }
       }

       // Initialize icon on load
       if (toggle) {
         updateThemeIcon();
         toggle.addEventListener('click', function(event) {
           event.preventDefault();
           var next = getTheme() === 'dark' ? 'light' : 'dark';
           setTheme(next);
           updateThemeIcon();
         });
       }
     })();
     function toggleMenu() {
       var menu = document.getElementById("menu");
       if (menu.classList.contains("open")) {
           menu.classList.remove("open");
       } else {
           menu.classList.add("open");
       }
     }
  </script>
</header>
