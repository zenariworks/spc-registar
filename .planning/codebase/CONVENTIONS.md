# Coding Conventions

**Analysis Date:** 2026-02-11

## Naming Patterns

**Files:**
- Module files: snake_case (e.g., `parohijan.py`, `marker_filter.py`)
- Admin files: `{model}_admin.py` (e.g., `parohijan_admin.py`, `vencanje_admin.py`)
- Form files: `{model}_form.py` (e.g., `parohijan_form.py`, `krstenje_form.py`)
- View files: `{noun}_view.py` (e.g., `parohijan_view.py`, `vencanje_view.py`)
- Utility files: `utils.py`, `utils_fasting.py`
- Migration files: auto-generated by Django (e.g., `0001_initial.py`)
- Management command files: `{action}.py` (e.g., `migracija_parohijana.py`, `unos_krstenja.py`)

**Functions:**
- snake_case: `latin_to_cyrillic()`, `calc_vaskrs()`, `get_query_variants()`
- Private/internal: prefix with underscore `_date_range()`, `_parse_data()`
- Handler methods in commands: `handle()`, `_parse_data()`
- Template tag filters: descriptive verb_noun: `markiraj()` (highlight)
- View functions: descriptive action: `unos_parohijana()` (add parishioner)

**Variables:**
- snake_case: `parsed_data`, `cleaned_data`, `search_fields`, `by_day`
- Constants (module-level): UPPERCASE: `MESECI` (months dictionary)
- Model fields: snake_case with Serbian descriptions via verbose_name
- Query aliases: descriptive: `q`, `clause`

**Types:**
- Model classes: PascalCase, end with domain entity name: `Parohijan`, `Vencanje`, `Slava`, `Krstenje`
- Form classes: PascalCase, follow pattern `{Model}Form`: `ParohijanForm`, `VencanjeForm`
- Filter classes: PascalCase, follow pattern `{Model}Filter`: `KrstenjeFilter`
- Admin classes: PascalCase, follow pattern `{Model}Admin`: `ParohijanAdmin`
- View classes: PascalCase, action-based names: `SpisakParohijana`, `ParohijanPDF`
- Utility classes: PascalCase: `Konvertor`, `RandomUtils`

## Code Style

**Formatting:**
- Black code formatter is configured (via pre-commit hook `black`)
- Line length: implicit from Black (default 88 characters)
- Tab width: 4 spaces (Python standard)

**Linting:**
- Tool: pylint (via `.pylintrc`)
- Failure threshold: 9.0 (fail-under=9 in pylintrc)
- Django plugin enabled: `pylint_django`
- Disabled rules: too-few-public-methods (to allow thin utility classes)
- Ignored paths: `*/migrations/*` (Django-generated files excluded)

**Additional Tools:**
- Ruff: Fast Python linter, configured in pre-commit with `--fix` and `--exit-non-zero-on-fix`
- isort: Import sorting with Black profile (`.isort.cfg` - `profile = black`)

## Import Organization

**Order:**
1. Standard library imports (e.g., `datetime`, `uuid`, `sqlite3`, `re`)
2. Django framework imports (e.g., `django.db`, `django.contrib`, `django.views`)
3. Third-party package imports (e.g., `django_filters`, `weasyprint`, `pillow`)
4. Local application imports (relative imports using `from registar.models`)

**Path Aliases:**
- No explicit path aliases configured
- Relative imports within Django app: `from registar.models import Parohijan`
- Absolute imports from app root: `from registar.utils import latin_to_cyrillic`

**Module Docstrings:**
- Module-level docstring in Serbian, describing purpose in single line or brief paragraph
- Examples:
  - `"""Модул модела парохијана у бази података."""`
  - `"""Правила поста - динамички рачунање на основу базе података."""`

## Error Handling

**Patterns:**
- Catch specific exceptions: `IntegrityError` (database), `Slava.DoesNotExist` (model lookup), `CommandError` (management commands)
- Generic fallback only in frontend filters: `except Exception` in `markiraj()` template tag (returns original value)
- Management commands: catch exceptions, log via `self.stdout.write()` or `print()`, continue processing
- Database operations in migrations: wrapped in try/except with `IntegrityError` handling, skip on constraint violation
- View functions: use Django shortcuts like `get_object_or_404()` for explicit error handling

Example error handling pattern:
```python
try:
    parohijan = Parohijan.objects.create(...)
    created_count += 1
except IntegrityError as e:
    self.stdout.write(f"Duplicate entry: {e}")
```

## Logging

**Framework:** No dedicated logging framework configured. Uses:
- `self.stdout.write()` in Django management commands for structured output
- `print()` for debug output (commented out in most migration commands)
- No centralized logger configuration

**Patterns:**
- Management commands: output via `self.stdout.write(f"Message: {count}")`
- Debug/commented output: uses `print()` with f-strings for inspection during development
- No log levels configured (info, warning, error abstraction not used)

## Comments

**When to Comment:**
- Docstrings required for: classes, public functions, module-level descriptions
- Inline comments for algorithmic explanation (e.g., Gauss algorithm for Easter calculation)
- Commented-out code preserved during development (debugging artifacts left in codebase)

**JSDoc/TSDoc:**
- Not applicable (Python project, not TypeScript)
- Docstring format: triple-quoted strings immediately after function/class definition

**Docstring Examples:**
```python
def latin_to_cyrillic(text: str) -> str:
    """
    Преводи српску латиницу у ћирилицу.
    Подржани су диграфи/триграфи: dž/Dž/DŽ, nj/Nj/NJ, lj/Lj/LJ, као и слова са
    дијакритицима: š/Š, č/Č, ć/Ć, ž/Ž, đ/Đ.
    """
```

## Function Design

**Size:** Functions range from 2-50 lines depending on complexity:
- Simple utility functions: 2-10 lines (e.g., `_date_range()`)
- View handlers: 15-30 lines (e.g., `unos_parohijana()`)
- Management command handlers: 40-100+ lines with nested loops

**Parameters:**
- Positional parameters: documented via type hints (e.g., `year: int`)
- Optional parameters: explicit `None` default or `blank=True` in Django models
- No *args or **kwargs patterns observed

**Return Values:**
- Explicit return type hints: `-> str`, `-> set[dt.date]`, `-> HttpResponse`
- View functions: return Django HttpResponse or rendered templates
- Model methods: return dates, sets of dates, or formatted strings
- Null/empty handling: return empty set/list rather than None

## Module Design

**Exports:**
- No `__all__` declarations observed
- Barrel files used for organizing related imports:
  - `registar/forms/__init__.py` imports all form classes for convenient access
  - `registar/filters/__init__.py` imports filter classes
  - `registar/models/__init__.py` imports model classes

**Barrel Files:**
- Location: `{package}/__init__.py`
- Pattern: `from .{module} import {Class}` for each submodule
- Usage: allows `from registar.forms import ParohijanForm` instead of `from registar.forms.parohijan_form`

**Class Meta:**
- Django models use `class Meta` for configuration:
  - `managed = True` (Django manages the table)
  - `db_table = "registered_name"` (explicit database table name in Serbian)
  - `verbose_name` and `verbose_name_plural` for admin/UI display in Serbian

## Type Hints

**Usage:**
- Function arguments: consistent use of type hints
- Return types: explicitly annotated (e.g., `-> HttpResponse`, `-> set[dt.date]`)
- Model fields: no explicit Python type hints, rely on Django field types
- Dict/Set types: modern syntax `set[dt.date]`, `dict[str, list]` observed in utils

**Examples:**
```python
def latin_to_cyrillic(text: str) -> str:
    """Convert Latin to Cyrillic."""

def get_query_variants(text: str) -> list[str]:
    """Return search query variants."""

def _date_range(start: dt.date, end: dt.date) -> set[dt.date]:
    """Return set of dates in closed interval."""
```

## Text and Internationalization

**Language:** All user-facing strings and docstrings in Serbian (Cyrillic):
- Model verbose names: Serbian (e.g., `verbose_name="име"`, `verbose_name="презиме"`)
- Admin field labels: Serbian (e.g., "Име и Презиме")
- Docstrings: Serbian language throughout
- Template content: Serbian labels and prompts

**Character Encoding:** UTF-8 throughout (no explicit encoding declarations needed, Python 3 default)

**Transliteration Utilities:**
- `registar/utils.py`: `latin_to_cyrillic()` and `cyrillic_to_latin()` for search compatibility
- Supports both Latin and Cyrillic input for Serbian text

## Architectural Patterns

**Separation of Concerns:**
- Models: `registar/models/*.py` - data layer
- Forms: `registar/forms/*.py` - input validation
- Views: `registar/views/*.py` - business logic and HTTP handling
- Admin: `registar/admin/*.py` - admin interface configuration
- Filters: `registar/filters/*.py` - queryset filtering
- Management commands: `registar/management/commands/*.py` - data import/export and utilities

**Django App Structure:**
- Single app: `registar/` containing all models, views, forms, admin, etc.
- No sub-packages except for related features (forms/, filters/, views/, models/, admin/, management/, templatetags/)

---

*Convention analysis: 2026-02-11*
